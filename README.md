# RamdoMario

[![Python version](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## 概要

RamdoMario は、OpenAI Gym のスーパーマリオブラザーズ環境 (`gym-super-mario-bros`) を使用して、マリオを自動でプレイさせることを目指すプロジェクトです。
現在のバージョンでは、事前に定義されたアクションセットからランダムにアクションを選択してマリオを操作します。
Pygame を利用して、実際のゲーム画面と、どのコントローラーボタンが押されているかを示す UI をリアルタイムで表示し、エージェントの動作確認や開発を支援します。

将来的には、この環境を基盤として、より高度な AI 技術（例: 大規模言語モデル(LLM)や強化学習）を用いたマリオの制御を探求することを目標としています。

## 特徴

- **スーパーマリオブラザーズの自動プレイ**: `gym-super-mario-bros` 環境上で動作します。
- **リアルタイム UI 表示**: Pygame を使用し、ゲーム画面と押下されているファミコンコントローラーのボタンを同時に表示します。
- **ランダムアクションエージェント**: 選択した移動パターン (例：`RIGHT_ONLY`) からランダムにアクションを選択してプレイします。
- **明確な入力表示**: どのアクションが選択され、コントローラーのどのボタンに対応するかが視覚的にわかります。
- **簡単な操作**: プレイ中にエピソードのリセットやプログラムの終了がキーボードから行えます。
- **開発の基盤**: 高度な AI エージェント開発のためのテストベッドとして利用可能です。

## 動作デモ

以下は、プログラム実行時のスクリーンショットです。左側にスーパーマリオブラザーズのゲーム画面、右側に現在の入力に対応するファミコンコントローラーのハイライトが表示されます。

![実行画面](./fig/1-1.gif)

## 必要システム構成

- Python 3.8 以上
- OS: Windows, macOS, Linux (一般的なデスクトップ環境)

## セットアップとインストール

1.  **リポジトリをクローン (またはファイルをダウンロード):**
    Git を使用している場合は、リポジトリをクローンします。

    ```bash
    git clone https://github.com/robustonian/randomario.git
    cd randomario
    ```

    Git を使用しない場合は、プロジェクトのファイルをダウンロードし、任意のディレクトリに展開してください。

2.  **仮想環境の作成および依存関係のインストール**
    プロジェクトのルートディレクトリで、以下のコマンドを実行して仮想環境を作成し、有効化します。

        ```bash
        uv sync
        ```

    これにより、`pyproject.toml` に記載された必要なライブラリがインストールされます。

3.  **コントローラー画像の配置:**
    fig フォルダ中にコントローラー画像 `famicon01_01.png` を配置してください。ディレクトリ構造は以下のようになります。
    ```
    randomario/
    ├── fig/
    │   └── famicon01_01.png
    ├── main.py
    ├── pyproject.toml
    ├── uv.lock
    └── README.md
    ```

## 実行方法

メインの Python スクリプト (例として `main.py` とします。実際のファイル名に置き換えてください) を実行します。

```bash
uv run main.py
```

実行すると Pygame ウィンドウが開き、スーパーマリオブラザーズのゲームがランダムなアクションで自動的にプレイされ、対応するコントローラーの UI が表示されます。

## 操作方法

プログラム実行中に以下のキー操作が可能です。

- **`R` キー**: 現在プレイ中のエピソードを中断し、ステージをリセットして新しいエピソードを開始します。
- **`ESC` キー**: プログラムを終了します。

## プロジェクト構成

```
randomario/
├── fig/
│   └── famicon01_01.png       # ファミコンコントローラーの画像ファイル
├── main.py                   # メインの Python スクリプト
├── pyproject.toml             # プロジェクトの設定および主要な依存関係定義ファイル
├── uv.lock                    # 依存関係のバージョンを固定するロックファイル
└── README.md                  # このドキュメント
```

## 依存関係

このプロジェクトの主要な依存ライブラリは以下の通りです (`pyproject.toml` に定義されています):

- `gym-super-mario-bros>=7.4.0`: スーパーマリオブラザーズの Gym 環境。
- `pygame>=2.6.1`: ゲーム画面および UI 表示に使用。
- `matplotlib>=3.7.5`: (注: `pyproject.toml` には記載がありますが、現在のランダムエージェントのスクリプトでは直接的には使用されていません。将来的なデータ可視化などで利用される可能性があります。)
- `opencv-python>=4.11.0.86`: (注: `pyproject.toml` には記載がありますが、現在のランダムエージェントのスクリプトでは直接的には使用されていません。将来的な画像認識ベースのエージェント開発で利用される可能性があります。)

これらのライブラリが依存する他のパッケージも一緒にインストールされます。詳細な依存関係ツリーと固定バージョンは `uv.lock` ファイル (uv を使用している場合) に記録されています。

<!-- ## 今後の展望

- **画像認識ベースのエージェント**: `opencv-python` を活用し、ゲーム画面の状態を認識して行動を決定するエージェントを開発する。
- **強化学習 (RL) エージェント**: DQN (Deep Q-Network) などの強化学習アルゴリズムを実装し、マリオがステージクリアを目指して学習するようにする。
- **大規模言語モデル (LLM) の活用**: LLM にゲームの状況を説明させたり、行動計画を生成させたりするなど、新しい形での AI エージェント制御を試みる。
- **パフォーマンスの最適化** および **コードのモジュール化**。 -->

## ライセンス

このプロジェクトは MIT License のもとで公開されています。

## 貢献について

- ファミコンのコントローラ画像は、以下のサイトに公開されている無料イラスト素材を使用させていただきました。感謝します。
  https://stockmaterial.net/game/380/
